!function(e){var t={};function a(n){if(t[n])return t[n].exports;var l=t[n]={i:n,l:!1,exports:{}};return e[n].call(l.exports,l,l.exports,a),l.l=!0,l.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)a.d(n,l,function(t){return e[t]}.bind(null,l));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=44)}({44:function(e,t){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,l(n.key),n)}}function l(e){var t=function(e,t){if("object"!=a(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var l=n.call(e,t||"default");if("object"!=a(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==a(t)?t:t+""}var o=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.panel=null,this.model=null,this.view=null,this.table=null,this.tableInnerHTML=null,this.timeout=null,this.activeCell=null,this.dragStartX=null,this.dragStartWidth=null,this.dragEl=null,this.dragging=!1,eael.hooks.addFilter("advancedDataTable.getClassProps","ea",this.getClassProps.bind(this)),eael.hooks.addFilter("advancedDataTable.setClassProps","ea",this.setClassProps.bind(this)),eael.hooks.addFilter("advancedDataTable.parseHTML","ea",this.parseHTML),eael.hooks.addAction("advancedDataTable.initEditor","ea",this.initEditor.bind(this)),eael.hooks.addAction("advancedDataTable.updateFromView","ea",this.updateFromView.bind(this)),eael.hooks.addAction("advancedDataTable.initInlineEdit","ea",this.initInlineEdit.bind(this)),eael.hooks.addAction("advancedDataTable.initPanelAction","ea",this.initPanelAction.bind(this)),eael.hooks.addAction("advancedDataTable.triggerTextChange","ea",this.triggerTextChange.bind(this)),elementor.hooks.addFilter("elements/widget/contextMenuGroups",this.initContextMenu),elementor.hooks.addAction("panel/open_editor/widget/eael-advanced-data-table",this.initPanel.bind(this))},(t=[{key:"updateFromView",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.model;if(n.remoteRender=a,elementor.config.version>"2.7.6"){var l=e.getContainer(),o=e.getContainer().settings.attributes;Object.keys(t).forEach((function(e){o[e]=t[e]})),parent.window.$e.run("document/elements/settings",{container:l,settings:o,options:{external:a}})}else Object.keys(t).forEach((function(e){n.setSetting(e,t[e])}));this.timeout=setTimeout((function(){n.remoteRender=!0}),1001)}},{key:"getClassProps",value:function(){return{view:this.view,model:this.model,table:this.table,activeCell:this.activeCell}}},{key:"setClassProps",value:function(e){var t=this;Object.keys(e).forEach((function(a){t[a]=e[a]}))}},{key:"parseHTML",value:function(e){return e.querySelectorAll("th, td").forEach((function(e){null!==e.querySelector(".inline-editor")&&(e.innerHTML=decodeURI(e.dataset.quill||""),delete e.dataset.quill)})),e}},{key:"cleanQuillHTML",value:function(e){var t=document.createElement("div");return t.innerHTML=e,t.querySelectorAll("p").forEach((function(e){var t=e.cloneNode(!0);t.querySelectorAll("br").forEach((function(e){return e.remove()})),t.textContent.trim()||e.remove()})),t.innerHTML}},{key:"initEditor",value:function(e){var t,a=this;e.dataset.quill=encodeURI(e.innerHTML),e.innerHTML='<div class="inline-editor">'.concat(this.cleanQuillHTML(e.innerHTML),"</div>");var n=new Quill(e.querySelector(".inline-editor"),{theme:"bubble",modules:{toolbar:["bold","italic","underline","strike","link",{list:"ordered"},{list:"bullet"}]}});setTimeout((function(){var e=n.theme.tooltip.root.querySelector("input[data-link]");e&&e.setAttribute("data-link","https://example.com")}),100),n.on("text-change",(function(t,l,o){clearTimeout(a.timeout),e.dataset.quill=encodeURI(n.root.innerHTML);var i=a.parseHTML(a.table.cloneNode(!0));a.tableInnerHTML=i.innerHTML,a.updateFromView(a.view,{ea_adv_data_table_static_html:i.innerHTML})})),$tableWrapper=jQuery(".ea-advanced-data-table-"+(null===(t=this.view)||void 0===t||null===(t=t.container)||void 0===t||null===(t=t.args)||void 0===t?void 0:t.id));var l=this.cleanQuillHTML;setTimeout((function(){$editors=$tableWrapper.find(".inline-editor .ql-editor"),$editors.each((function(){jQuery(this).html(l(jQuery(this).html()))}))}),1e3)}},{key:"initInlineEdit",value:function(){var e=this,t=setInterval((function(){e.view.el.querySelector(".ea-advanced-data-table")&&(e.table!==e.view.el.querySelector(".ea-advanced-data-table")&&(e.table=e.view.el.querySelector(".ea-advanced-data-table"),e.table.classList.contains("ea-advanced-data-table-static")&&e.table.querySelectorAll("th, td").forEach((function(t){e.initEditor(t)})),e.table.addEventListener("mousedown",(function(t){t.stopPropagation(),"th"===t.target.tagName.toLowerCase()&&(e.dragging=!0,e.dragEl=t.target,e.dragStartX=t.pageX,e.dragStartWidth=t.target.offsetWidth),"th"===t.target.tagName.toLowerCase()||"td"===t.target.tagName.toLowerCase()?e.activeCell=t.target:"th"===t.target.parentNode.tagName.toLowerCase()||"td"===t.target.parentNode.tagName.toLowerCase()?e.activeCell=t.target.parentNode:"th"===t.target.parentNode.parentNode.tagName.toLowerCase()||"td"===t.target.parentNode.parentNode.tagName.toLowerCase()?e.activeCell=t.target.parentNode.parentNode:"th"!==t.target.parentNode.parentNode.parentNode.tagName.toLowerCase()&&"td"!==t.target.parentNode.parentNode.parentNode.tagName.toLowerCase()||(e.activeCell=t.target.parentNode.parentNode.parentNode)})),e.table.addEventListener("mousemove",(function(t){e.dragging&&(e.dragEl.style.width="".concat(e.dragStartWidth+(event.pageX-e.dragStartX),"px"))})),e.table.addEventListener("mouseup",(function(t){if(e.dragging)if(e.dragging=!1,clearTimeout(e.timeout),e.table.classList.contains("ea-advanced-data-table-static")){var a=e.parseHTML(e.table.cloneNode(!0));e.updateFromView(e.view,{ea_adv_data_table_static_html:a.innerHTML})}else{var n=[];e.table.querySelectorAll("th").forEach((function(e,t){n[t]=e.style.width})),e.updateFromView(e.view,{ea_adv_data_table_dynamic_th_width:n})}})),e.table.addEventListener("dblclick",(function(t){if("th"===t.target.tagName.toLowerCase())if(t.stopPropagation(),clearTimeout(e.timeout),e.table.classList.contains("ea-advanced-data-table-static")){var a=e.parseHTML(e.table.cloneNode(!0));e.updateFromView(e.view,{ea_adv_data_table_static_html:a.innerHTML})}else{var n=[];e.table.querySelectorAll("th").forEach((function(e,t){n[t]=e.style.width})),e.updateFromView(e.view,{ea_adv_data_table_dynamic_th_width:n})}}))),clearInterval(t))}),500)}},{key:"initPanelAction",value:function(){var e=this;this.panel.content.el.onclick=function(t){if("ea:advTable:export"==t.target.dataset.event){for(var a=e.table.querySelectorAll("table tr"),n=[],l=0;l<a.length;l++){var o=[],i=a[l].querySelectorAll("th, td");if(e.table.classList.contains("ea-advanced-data-table-static"))for(var r=0;r<i.length;r++){var d=decodeURI(i[r].dataset.quill).replace(/"/g,'""');d='"'.concat(d,'"'),o.push(d)}else for(var s=0;s<i.length;s++)o.push(JSON.stringify(i[s].innerHTML.replace(/,"""([^"]+)""",/g,',"$1",').trim()));n.push(o.join(","))}var c=new Blob([n.join("\n")],{type:"text/csv"}),u=parent.document.createElement("a");u.classList.add("ea-adv-data-table-download-".concat(e.model.attributes.id)),u.download="ea-adv-data-table-".concat(e.model.attributes.id,".csv"),u.href=window.URL.createObjectURL(c),u.style.display="none",parent.document.body.appendChild(u),u.click(),parent.document.querySelector(".ea-adv-data-table-download-".concat(e.model.attributes.id)).remove()}else if("ea:advTable:import"==t.target.dataset.event){var v=e.panel.content.el.querySelector(".ea_adv_table_csv_string"),h=e.panel.content.el.querySelector(".ea_adv_table_csv_string_table").checked,b=v.value.split("\n"),p="",f="";if(v.value.length>0&&(f+="<tbody>",b.forEach((function(e,t){for(var a=[],n="",l=!1,o=0;o<e.length;){var i=e[o];'"'===i?l&&'"'===e[o+1]?(n+='"',o++):l=!l:","!==i||l?n+=i:(a.push(n),n=""),o++}a.push(n),a.length>0&&(h&&0==t?(p+="<thead><tr>",a.forEach((function(e){p+="<th>".concat(e,"</th>")})),p+="</tr></thead>"):(f+="<tr>",a.forEach((function(e){f+="<td>".concat(e,"</td>")})),f+="</tr>"))})),f+="</tbody>",p.length>0||f.length>0)){e.tableInnerHTML=p+f,e.updateFromView(e.view,{ea_adv_data_table_csv_html:p+f},!0);var g=setInterval((function(){e.view.el.querySelector(".ea-advanced-data-table").innerHTML==p+f&&(clearInterval(g),eael.hooks.doAction("advancedDataTable.initInlineEdit"))}),500)}v.value=""}eael.hooks.doAction("advancedDataTable.panelAction",e.panel,e.model,e.view,t)}}},{key:"initPanel",value:function(e,t,a){var n=this;this.panel=e,this.model=t,this.view=a;var l=".ea-advanced-data-table-".concat(this.view.container.args.id),o=this.view.el.querySelector(".ea-advanced-data-table"+l);eael.hooks.doAction("advancedDataTable.initInlineEdit"),eael.hooks.doAction("advancedDataTable.initPanelAction"),eael.hooks.doAction("advancedDataTable.afterInitPanel",e,t,a),t.once("editor:close",(function(){if(!o)return!1;var e=n.parseHTML(o.cloneNode(!0));n.tableInnerHTML=e.innerHTML}))}},{key:"initContextMenu",value:function(e,t){return"eael-advanced-data-table"==t.options.model.attributes.widgetType&&"static"==t.options.model.attributes.settings.attributes.ea_adv_data_table_source&&e.push({name:"ea_advanced_data_table",actions:[{name:"add_row_above",title:"Add Row Above",callback:function(){var e=eael.hooks.applyFilters("advancedDataTable.getClassProps"),t=e.view,a=e.table,n=e.activeCell;if(jQuery(a).find("tr:empty").each((function(){0==jQuery(this).find("td").length&&this.remove()})),null!==n&&"th"!=n.tagName.toLowerCase()&&n.parentNode.rowIndex){for(var l=n.parentNode.rowIndex,o=a.insertRow(l),i=0;i<a.rows[0].cells.length;i++){var r=o.insertCell(i);eael.hooks.doAction("advancedDataTable.initEditor",r)}eael.hooks.applyFilters("advancedDataTable.setClassProps",{activeCell:null});var d=eael.hooks.applyFilters("advancedDataTable.parseHTML",a.cloneNode(!0));eael.hooks.doAction("advancedDataTable.updateFromView",t,{ea_adv_data_table_static_html:d.innerHTML}),eael.hooks.doAction("advancedDataTable.triggerTextChange",a)}}},{name:"add_row_below",title:"Add Row Below",callback:function(){var e=eael.hooks.applyFilters("advancedDataTable.getClassProps"),t=e.view,a=e.table,n=e.activeCell;if(null!==n){for(var l=n.parentNode.rowIndex+1,o=a.insertRow(l),i=0;i<a.rows[0].cells.length;i++){var r=o.insertCell(i);eael.hooks.doAction("advancedDataTable.initEditor",r)}eael.hooks.applyFilters("advancedDataTable.setClassProps",{activeCell:null});var d=eael.hooks.applyFilters("advancedDataTable.parseHTML",a.cloneNode(!0));eael.hooks.doAction("advancedDataTable.updateFromView",t,{ea_adv_data_table_static_html:d.innerHTML}),eael.hooks.doAction("advancedDataTable.triggerTextChange",a)}}},{name:"add_column_left",title:"Add Column Left",callback:function(){var e=eael.hooks.applyFilters("advancedDataTable.getClassProps"),t=e.view,a=e.table,n=e.activeCell;if(null!==n){for(var l=n.cellIndex,o=0;o<a.rows.length;o++)if("th"==a.rows[o].cells[0].tagName.toLowerCase()){var i=a.rows[o].insertBefore(document.createElement("th"),a.rows[o].cells[l]);eael.hooks.doAction("advancedDataTable.initEditor",i)}else{var r=a.rows[o].insertCell(l);eael.hooks.doAction("advancedDataTable.initEditor",r)}eael.hooks.applyFilters("advancedDataTable.setClassProps",{activeCell:null});var d=eael.hooks.applyFilters("advancedDataTable.parseHTML",a.cloneNode(!0));eael.hooks.doAction("advancedDataTable.updateFromView",t,{ea_adv_data_table_static_html:d.innerHTML}),eael.hooks.doAction("advancedDataTable.triggerTextChange",a)}}},{name:"add_column_right",title:"Add Column Right",callback:function(){var e=eael.hooks.applyFilters("advancedDataTable.getClassProps"),t=e.view,a=e.table,n=e.activeCell;if(null!==n){for(var l=n.cellIndex+1,o=0;o<a.rows.length;o++)if("th"==a.rows[o].cells[0].tagName.toLowerCase()){var i=a.rows[o].insertBefore(document.createElement("th"),a.rows[o].cells[l]);eael.hooks.doAction("advancedDataTable.initEditor",i)}else{var r=a.rows[o].insertCell(l);eael.hooks.doAction("advancedDataTable.initEditor",r)}eael.hooks.applyFilters("advancedDataTable.setClassProps",{activeCell:null});var d=eael.hooks.applyFilters("advancedDataTable.parseHTML",a.cloneNode(!0));eael.hooks.doAction("advancedDataTable.updateFromView",t,{ea_adv_data_table_static_html:d.innerHTML}),eael.hooks.doAction("advancedDataTable.triggerTextChange",a)}}},{name:"delete_row",title:"Delete Row",callback:function(){var e=eael.hooks.applyFilters("advancedDataTable.getClassProps"),t=e.view,a=e.table,n=e.activeCell;if(null!==n){var l=n.parentNode.rowIndex;a.deleteRow(l),eael.hooks.applyFilters("advancedDataTable.setClassProps",{activeCell:null});var o=eael.hooks.applyFilters("advancedDataTable.parseHTML",a.cloneNode(!0));eael.hooks.doAction("advancedDataTable.updateFromView",t,{ea_adv_data_table_static_html:o.innerHTML}),eael.hooks.doAction("advancedDataTable.triggerTextChange",a)}}},{name:"delete_column",title:"Delete Column",callback:function(){var e=eael.hooks.applyFilters("advancedDataTable.getClassProps"),t=e.view,a=e.table,n=e.activeCell;if(null!==n){for(var l=n.cellIndex,o=0;o<a.rows.length;o++)a.rows[o].deleteCell(l);eael.hooks.applyFilters("advancedDataTable.setClassProps",{activeCell:null});var i=eael.hooks.applyFilters("advancedDataTable.parseHTML",a.cloneNode(!0));eael.hooks.doAction("advancedDataTable.updateFromView",t,{ea_adv_data_table_static_html:i.innerHTML}),eael.hooks.doAction("advancedDataTable.triggerTextChange",a)}}}]}),e}},{key:"triggerTextChange",value:function(e){if(e.classList.contains("ea-advanced-data-table-static")){var t,a=(t=(t=jQuery("thead tr:first-child th:first-child .ql-editor p",e)).length?t:jQuery("tbody tr:first-child td:first-child .ql-editor p",e)).html();t.html(a+" "),setTimeout((function(){t.html(a)}),1100)}}}])&&n(e.prototype,t),a&&n(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,a}();eael.hooks.addAction("editMode.init","ea",(function(){if(eael.elementStatusCheck("eaelAdvancedDataTableEditor"))return!1;new o}))}});